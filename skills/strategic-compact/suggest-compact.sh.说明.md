# suggest-compact.sh 脚本说明

## 脚本功能

这是一个 **战略压缩建议脚本**，在适当的时候建议用户手动压缩上下文，避免自动压缩丢失重要信息。

## 工作原理

### 触发条件
- 在使用 Edit 或 Write 工具时触发
- 通过 PostToolUse Hook 调用

### 检测逻辑
1. 统计当前会话中工具调用次数
2. 达到阈值（默认：50 次调用）时建议压缩
3. 之后每 25 次调用提醒一次

### 用户交互
- 输出建议消息到标准错误（stderr）
- 不会阻止操作继续
- 用户可以选择是否压缩

## 配置环境变量

```bash
COMPACT_THRESHOLD=50  # 首次建议的阈值（工具调用次数）
```

## 使用场景

### 适用场景
✅ 长时间编码会话
✅ 大量文件编辑操作
✅ 上下文接近限制时

### 不适用场景
❌ 短暂的查询会话
❌ 只读操作（不修改文件）
❌ 已经压缩过的会话

## 输出示例

```
[Hook] 💡 建议现在压缩上下文
[Hook] 已进行 50 次工具调用
[Hook] 使用 /compact 手动压缩以保留重要状态
```

## 中文版说明

此脚本帮助用户在合适的时候进行上下文压缩，避免：
- ❌ 自动压缩在任务中途丢失上下文
- ❌ 压缩时机不当导致信息丢失
- ❌ 无法控制压缩的内容和时机

推荐使用场景：
- ✅ 完成功能规划后，开始实施前
- ✅ 完成调试后，继续开发前
- ✅ 完成一个阶段后，开始新阶段前

---

**相关文档：**
- [战略压缩技能](./SKILL.md)
- [长篇指南 - Token 优化](../../the-longform-guide.md)
