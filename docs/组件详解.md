# 组件详解 - Everything Claude Code 核心组件

**目标：** 深入理解 Everything Claude Code 的各个组件及其使用方法

---

## 目录

- [Skills（技能）](#skills技能)
- [Commands（命令）](#commands命令)
- [Agents（代理）](#agents代理)
- [Hooks（钩子）](#hooks钩子)
- [Rules（规则）](#rules规则)
- [Contexts（上下文）](#contexts上下文)

---

## Skills（技能）

### 什么是 Skills？

Skills 是包含特定知识和工作流程指南的文件，Claude 可以根据任务上下文自主激活和使用它们。

**核心特点：**
- 📚 知识封装：将领域知识打包
- 🎯 上下文感知：Claude 根据任务自动选择
- 🔄 可重用：一次定义，多次使用
- 📈 可进化：通过 `/learn` 不断改进

### 技能文件结构

```
~/.claude/skills/
├── coding-standards/
│   └── SKILL.md          # 主技能文件
├── frontend-patterns/
│   ├── SKILL.md
│   └── reference.md      # 参考文档（可选）
└── tdd-workflow/
    ├── SKILL.md
    ├── examples/         # 示例代码
    └── README.md         # 说明文档
```

### SKILL.md 格式

```markdown
---
name: tdd-workflow
description: 测试驱动开发工作流程指南
---

# TDD 工作流

## 触发条件
- 用户需要编写测试
- 提到 TDD、测试驱动开发
- 需要确保代码质量

## 核心原则
1. 先写测试，再写代码
2. 测试驱动开发
3. 小步快跑，频繁重构

## 工作流程
### 步骤 1：编写测试
### 步骤 2：运行测试（失败）
### 步骤 3：编写代码
### 步骤 4：运行测试（通过）
### 步骤 5：重构代码

## 示例
[代码示例]

## 注意事项
- 测试要简单明了
- 避免过度测试
- 保持高测试覆盖率
```

### 核心 Skills 详解

#### 1. coding-standards（编码标准）

**作用：** 定义 TypeScript/JavaScript 编码规范

**核心内容：**
- 变量命名规范
- 函数命名规范
- 不可变性模式（Immutability）
- 错误处理最佳实践

**使用场景：**
- 编写任何代码时
- 代码审查时
- 重构代码时

**关键要点：**
```typescript
// ✅ GOOD: 不可变更新
const updatedUser = { ...user, name: 'New Name' }

// ❌ BAD: 直接修改
user.name = 'New Name'
```

#### 2. tdd-workflow（TDD 工作流）

**作用：** 指导测试驱动开发流程

**核心原则：**
- 红-绿-重构循环
- 先写测试，再写代码
- 保持简单测试

**使用场景：**
- 开发新功能时
- 修复 Bug 时
- 重构代码时

#### 3. security-review（安全审查）

**作用：** 检查代码中的安全漏洞

**检查项：**
- SQL 注入
- XSS 攻击
- 硬编码密钥
- 输入验证
- 权限检查

**使用场景：**
- 代码审查时
- 部署前检查
- 安全审计时

#### 4. continuous-learning（持续学习）

**作用：** 从会话中提取可重用模式

**工作流程：**
```
解决问题 → /learn → AI 分析 → 提取模式 → 保存为技能
```

**使用场景：**
- 解决复杂问题后
- 发现新的最佳实践后
- 积累团队经验时

---

## Commands（命令）

### 什么是 Commands？

Commands 是通过斜杠（`/`）触发的快捷提示词，用于执行特定的任务或工作流。

**核心特点：**
- ⚡ 快速执行：一行命令完成复杂任务
- 📋 标准化流程：确保一致性
- 🎯 参数化：可以接受参数
- 🔗 可链式：多个命令组合使用

### 命令文件结构

```
~/.claude/commands/
├── plan.md
├── learn.md
├── code-review.md
└── refactor-clean.md
```

### 命令文件格式

```markdown
# /plan - 功能规划

触发条件：需要规划新功能或重构时运行

## 输出格式

创建详细的实施计划，包含：
1. 功能概述
2. 技术方案
3. 实施步骤
4. 风险评估
5. 成功标准

## 使用示例

/plan 添加用户认证功能
```

### 核心 Commands 详解

#### 1. /plan - 功能规划

**作用：** 创建详细的功能实施计划

**输出内容：**
- 功能概述
- 架构设计
- 实施步骤
- 依赖关系
- 风险评估

**使用示例：**
```
/plan 实现一个基于 JWT 的用户认证系统
```

#### 2. /learn - 模式提取

**作用：** 从当前会话中提取可重用的模式

**工作流程：**
1. 分析会话内容
2. 识别有价值的模式
3. 创建技能文件
4. 保存到 `~/.claude/skills/learned/`

**使用示例：**
```
我刚解决了一个复杂的状态管理问题

/learn

# Claude 会提取解决方案并保存为技能
```

#### 3. /code-review - 代码审查

**作用：** 全面的代码质量审查

**检查内容：**
- 代码规范
- 性能问题
- 安全漏洞
- 测试覆盖
- 文档完整性

**使用示例：**
```
/code-review src/auth/UserService.ts

# Claude 会进行全面审查
```

#### 4. /refactor-clean - 重构清理

**作用：** 清理死代码和未使用的文件

**清理内容：**
- 未使用的导入
- 死代码（dead code）
- 重复代码
- 零散的 .md 文件
- 过时的注释

**使用示例：**
```
/refactor-clean

# Claude 会识别并建议清理
```

#### 5. /verify - 验证更改

**作用：** 验证代码更改的正确性

**验证内容：**
- 类型检查
- 代码规范
- 测试通过
- 构建成功

**使用示例：**
```
修改了用户认证逻辑

/verify

# Claude 会验证所有更改
```

---

## Agents（代理）

### 什么是 Agents？

Agents 是具有特定领域专业知识和有限工具集的子代理，主 Claude 可以将任务委托给它们。

**核心特点：**
- 🎯 专业化：每个代理专注特定领域
- 🔧 有限工具：只配备必要的工具
- 🔄 可并行：多个代理可以同时工作
- 📦 沙箱化：限制权限和范围

### 代理文件结构

```
~/.claude/agents/
├── planner.md
├── architect.md
├── code-reviewer.md
└── security-reviewer.md
```

### 代理文件格式

```markdown
---
name: planner
description: 专家规划专员，专注于创建可执行的实施计划
tools: ["Read", "Grep", "Glob"]
model: opus
---

你是一个专家规划专员...

## 工作流程
1. 需求分析
2. 架构评审
3. 步骤分解
4. 实施顺序

## 输出格式
[实施计划模板]
```

### 核心 Agents 详解

#### 1. planner（规划者）

**专长：** 功能规划和实施计划

**工具集：** Read, Grep, Glob（只读工具）

**使用场景：**
- 新功能开发
- 复杂重构
- 架构设计

**工作方式：**
```
用户请求 → planner 分析 → 创建详细计划 → 返回给用户
```

#### 2. architect（架构师）

**专长：** 系统架构和技术决策

**工具集：** Read, Grep, Glob（只读工具）

**使用场景：**
- 系统设计
- 技术选型
- 架构评审

**输出内容：**
- 系统架构图
- 技术栈选择
- 设计决策理由

#### 3. code-reviewer（代码审查员）

**专长：** 代码质量和最佳实践审查

**工具集：** Read, Grep（只读工具）

**审查内容：**
- 代码规范
- 性能问题
- 可维护性
- 测试覆盖

**使用场景：**
- PR 审查
- 代码质量检查
- 重构建议

#### 4. security-reviewer（安全审查员）

**专长：** 安全漏洞和风险评估

**工具集：** Read, Grep（只读工具）

**检查内容：**
- SQL 注入
- XSS 攻击
- 权限问题
- 密钥管理
- 输入验证

#### 5. refactor-cleaner（重构清理者）

**专长：** 清理死代码和重构

**工具集：** Read, Write, Edit, Grep（读写工具）

**清理内容：**
- 删除死代码
- 合并重复代码
- 优化结构
- 更新导入

---

## Hooks（钩子）

### 什么是 Hooks？

Hooks 是在特定事件时自动触发的脚本，用于自动化工作流和强制执行规则。

**核心特点：**
- 🔄 自动化：事件驱动自动执行
- 🎯 强制性：不可跳过（除了特定场景）
- ⛓ 轻量级：快速执行
- 🔗 可链式：多个 hooks 组合

### Hook 类型

| 事件 | 触发时机 | 用途 |
|------|---------|------|
| **PreToolUse** | 工具使用前 | 验证、提醒、拦截 |
| **PostToolUse** | 工具使用后 | 格式化、反馈循环 |
| **UserPromptSubmit** | 发送消息时 | 强制评估、预处理 |
| **Stop** | 完成响应时 | 总结、检查、提醒 |
| **PreCompact** | 压缩前 | 保存状态 |
| **SessionStart** | 会话开始 | 加载配置 |
| **SessionEnd** | 会话结束 | 保存状态、评估 |

### Hooks 配置示例

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "tool == \"Bash\" && tool_input.command matches \"(npm run dev)\"",
        "hooks": [
          {
            "type": "command",
            "command": "echo '[Hook] 必须在 tmux 中运行开发服务器' >&2; exit 1"
          }
        ],
        "description": "阻止在 tmux 外运行开发服务器"
      }
    ],
    "PostToolUse": [
      {
        "matcher": "tool == \"Edit\" && tool_input.file_path matches \"\\\\.(ts|tsx)$\"",
        "hooks": [
          {
            "type": "command",
            "command": "npx prettier --write ${tool_input.file_path}"
          }
        ],
        "description": "自动格式化 TypeScript 文件"
      }
    ]
  }
}
```

### 核心 Hooks 用例

#### 1. 自动格式化代码

```json
{
  "PostToolUse": [
    {
      "matcher": "Edit && .ts/.tsx/.js/.jsx",
      "hooks": [{
        "command": "npx prettier --write ${tool_input.file_path}"
      }]
    }
  ]
}
```

#### 2. 阻止危险操作

```json
{
  "PreToolUse": [
    {
      "matcher": "Bash && (rm -rf | drop table)",
      "hooks": [{
        "command": "echo '[Hook] 危险命令已阻止' >&2; exit 1"
      }]
    }
  ]
}
```

#### 3. 提醒最佳实践

```json
{
  "PreToolUse": [
    {
      "matcher": "Bash && (git push)",
      "hooks": [{
        "command": "echo '[Hook] 提醒：提交前请审查代码' >&2"
      }]
    }
  ]
}
```

---

## Rules（规则）

### 什么是 Rules？

Rules 是 Claude 应该始终遵循的最佳实践和指导原则。

**核心特点：**
- 📖 强制性：总是适用
- 🎯 项目特定：针对具体项目
- 📝 模块化：按关注点分组
- ✅ 可验证：容易检查

### Rules 文件组织

```
~/.claude/rules/
├── security.md       # 安全规则
├── coding-style.md  # 编码风格
├── testing.md        # 测试规则
├── git-workflow.md   # Git 工作流
└── agents.md         # 代理使用规则
```

### Rules 文件示例

#### coding-style.md

```markdown
# 编码风格规则

## 必须遵守

1. **不可变性优先**
   - 使用展开运算符更新对象
   - 避免直接修改对象/数组

2. **函数命名**
   - 使用动词+名词：`getUserData()`
   - 布尔值返回：`isValidUser()`
   - 动作函数：`sendEmail()`

3. **错误处理**
   - 始终使用 try-catch
   - 提供有意义的错误消息
   - 记录错误上下文

## 禁止事项

- ❌ 提交 console.log
- ❌ 硬编码密钥
- ❌ 使用 any 类型
- ❌ 跳过测试
```

#### testing.md

```markdown
# 测试规则

## 测试覆盖率要求

- 单元测试：> 80%
- 集成测试：关键路径
- E2E 测试：主要用户流程

## TDD 工作流

1. 先写测试
2. 运行测试（失败）
3. 编写代码
4. 运行测试（通过）
5. 重构代码
6. 运行测试（仍然通过）

## 禁止事项

- ❌ 跳过测试
- ❌ 提交未测试的代码
- ❌ 测试覆盖不足的核心功能
```

---

## Contexts（上下文）

### 什么是 Contexts？

Contexts 是针对不同场景的上下文模板，用于快速切换工作模式。

### Context 类型

| Context | 用途 | 场景 |
|---------|------|------|
| **dev.md** | 开发上下文 | 日常开发工作 |
| **research.md** | 研究上下文 | 探索新技术、调研 |
| **review.md** | 审查上下文 | 代码审查、PR 审核 |

### Context 切换

```bash
# 切换到开发上下文
/context dev

# 切换到研究上下文
/context research

# 切换到审查上下文
/context review
```

---

## 组件协作示例

### 示例 1：开发新功能

```
1. /plan → planner 代理创建实施计划
2. /tdd → tdd-workflow 技能指导测试驱动开发
3. 实现... → coding-standards 技能确保代码质量
4. /verify → 验证更改
5. /code-review → code-reviewer 代理审查代码
6. Hooks 自动格式化代码和类型检查
```

### 示例 2：代码审查流程

```
1. /code-review → code-reviewer 代理进行审查
2. security-review 技能检查安全问题
3. coding-standards 技能检查代码规范
4. 返回审查结果和改进建议
```

### 示例 3：清理重构

```
1. /refactor-clean → refactor-cleaner 代理清理代码
2. Hooks 自动检测 console.log
3. 删除死代码和未使用文件
4. 自动格式化和类型检查
```

---

## 下一步

现在你已经理解了所有核心组件：

1. **实践使用：**
   - [快速开始](./快速开始.md)
   - [实战案例](./实战案例.md)

2. **深入学习：**
   - [短篇指南](./translated/the-shortform-guide.md)
   - [长篇指南](./translated/the-longform-guide.md)

3. **定制配置：**
   - [定制指南](./定制指南.md)

---

**最后更新：** 2025-01-30
**难度级别：** ⭐⭐ (中级)
**下一篇：** [实战案例](./实战案例.md)
